<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>V for Video! üåå</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: #fff;
      text-align: center;
    }
    .container {
      max-width: 700px;
      margin: auto;
      padding: 20px;
    }
    iframe {
      width: 100%;
      height: 315px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #ff9800;
      color: #fff;
      transition: 0.3s;
    }
    button:hover {
      background: #e68900;
    }
    .hidden {
      display: none;
    }
    .score-card {
      background: rgba(0,0,0,0.4);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
    }
    #progressTracker {
      margin: 15px 0;
      font-weight: bold;
    }
    #nextBtn {
      background: #4caf50;
    }
    #nextBtn:disabled {
      background: grey;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ V for Video Quest!</h1>
    <p>Watch the video for at least <b>400 seconds</b> to earn 10 points.</p>

    <div id="progressTracker"></div>
    <div id="videoContainer"></div>
    <div id="question"></div>
    <div id="options"></div>
    <p id="nextCountdown"></p>
    <button id="nextBtn" disabled>‚è≠Ô∏è Next</button>
    <div class="score-card hidden" id="scoreCard"></div>
  </div>

  <!-- Load YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    const quizData = [
      {
        video: "https://www.youtube.com/watch?v=NquuITL9-ZA",
        q: "What is the video about?",
        options: ["AI", "Blockchain", "Cooking", "Astronomy"],
        correct: 0
      },
      {
        video: "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
        q: "Who is the singer?",
        options: ["Rick Astley", "Elvis", "Beatles", "MJ"],
        correct: 0
      }
    ];

    let current = 0;
    let correctCount = 0;
    let totalWrongGuesses = 0;
    let guessesPerQuestion = [];
    let nextCountdown = 480;
    let nextCountdownEnd;
    let nextCountdownInterval;
    let totalTime = 0;
    let totalTimeInterval;
    let player;
    let watchTime = 0;
    let watchInterval;
    let pointsAwarded = false;

    const videoContainer = document.getElementById("videoContainer");
    const questionEl = document.getElementById("question");
    const optionsEl = document.getElementById("options");
    const nextBtn = document.getElementById("nextBtn");
    const scoreCard = document.getElementById("scoreCard");
    const progressTracker = document.getElementById("progressTracker");
    const nextCountdownEl = document.getElementById("nextCountdown");

    // When YouTube API is ready
    function onYouTubeIframeAPIReady() {
      loadQuestion();
    }

    function loadQuestion() {
      if (current >= quizData.length) {
        return showScore();
      }
      const data = quizData[current];
      guessesPerQuestion[current] = 0;

      questionEl.innerText = data.q;
      progressTracker.innerText = `üìç Question ${current + 1} of ${quizData.length}`;

      const videoId = data.video.split("v=")[1];
      videoContainer.innerHTML = `<div id="player"></div>`;

      watchTime = 0;
      pointsAwarded = false;

      player = new YT.Player("player", {
        height: "315",
        width: "100%",
        videoId: videoId,
        events: {
          onStateChange: onPlayerStateChange
        }
      });

      optionsEl.innerHTML = "";
      data.options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.innerText = option;
        const correctAnswerString = data.options[data.correct];
        btn.onclick = () => handleAnswer(btn, correctAnswerString);
        optionsEl.appendChild(btn);
      });

      nextBtn.disabled = true;
      nextCountdown = 480;
      nextCountdownEnd = Date.now() + nextCountdown * 1000;
      updateNextCountdown();
      clearInterval(nextCountdownInterval);
      nextCountdownInterval = setInterval(updateNextCountdown, 1000);
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        if (!watchInterval) {
          watchInterval = setInterval(() => {
            watchTime++;
            if (watchTime >= 400 && !pointsAwarded) {
              correctCount += 10;
              pointsAwarded = true;
              console.log("‚úÖ Awarded 10 points for watching 400s");
            }
          }, 1000);
        }
      } else {
        clearInterval(watchInterval);
        watchInterval = null;
      }
    }

    function handleAnswer(btn, correctAnswerString) {
      guessesPerQuestion[current]++;
      if (btn.innerText === correctAnswerString) {
        btn.style.background = "green";
        nextBtn.disabled = false;
      } else {
        btn.style.background = "red";
        totalWrongGuesses++;
      }
    }

    function updateNextCountdown() {
      const remaining = Math.max(0, Math.floor((nextCountdownEnd - Date.now()) / 1000));
      nextCountdownEl.innerText = `‚è≥ You can click Next in ${remaining} seconds`;
      if (remaining <= 0) {
        nextBtn.disabled = false;
        clearInterval(nextCountdownInterval);
        nextCountdownEl.innerText = "‚úÖ You can now go to the next question";
      }
    }

    nextBtn.addEventListener("click", () => {
      current++;
      loadQuestion();
    });

    function showScore() {
      clearInterval(totalTimeInterval);
      clearInterval(nextCountdownInterval);
      scoreCard.classList.remove("hidden");
      scoreCard.innerHTML = `
        <p>üèÜ Score: ${correctCount} points</p>
        <p>‚ùå Wrong Attempts: ${totalWrongGuesses}</p>
        <p>‚è±Ô∏è Time Taken: ${totalTime} seconds</p>
        <p>üìù Guesses per Question: ${guessesPerQuestion.join(", ")}</p>
      `;
    }

    totalTimeInterval = setInterval(() => {
      totalTime++;
    }, 1000);
  </script>
</body>
</html>
